generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  USER
  ADMIN
}

// ==================== AUTH ====================
model User {
  userId    Int      @id @default(autoincrement())
  email     String   @unique
  password  String
  fullName  String?
  avt       String?  @db.Text
  role      UserRole @default(USER)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("User")
}

// ==================== CONTENT ====================
model Topic {
  topicId      Int          @id @default(autoincrement())
  name         String
  imgURL       String?      @db.Text
  vocabularies Vocabulary[]
  tests        Test[]

  @@map("Topic")
}

model Vocabulary {
  vocabId         Int     @id @default(autoincrement())
  topicId         Int
  word            String
  meaning         String
  ipa             String?
  audioURL        String? @db.Text
  imgURL          String? @db.Text
  exampleSentence String? @db.Text
  exampleMeaning  String? @db.Text
  topic           Topic   @relation(fields: [topicId], references: [topicId], onDelete: Cascade)

  @@map("Vocabulary")
}

model Test {
  testId    Int        @id @default(autoincrement())
  topicId   Int
  imgURL    String?    @db.Text
  title     String?
  maxScore  Int        @default(100)
  timeLimit Int        @default(0)
  topic     Topic      @relation(fields: [topicId], references: [topicId], onDelete: Cascade)
  questions Question[]

  @@map("Test")
}

enum QuestionType {
  CHOICE
  FILL
  MATCH
}

model Question {
  questionId     Int          @id @default(autoincrement())
  testId         Int
  relatedVocabId Int?
  content        String       @db.Text
  type           QuestionType @default(CHOICE)
  answers        Json
  correctAnswer  String
  test           Test         @relation(fields: [testId], references: [testId], onDelete: Cascade)

  @@map("Question")
}

// ==================== LEARNING ====================
model UserVocabulary {
  userVocabId    Int      @id @default(autoincrement())
  userId         Int
  vocabId        Int
  isMarked       Boolean  @default(false)
  errorCount     Int      @default(0)
  lastReviewedAt DateTime @default(now())

  @@unique([userId, vocabId])
  @@map("UserVocabulary")
}

model UserTopicProgress {
  userId               Int
  topicId              Int
  completionPercentage Int      @default(0)
  isCompleted          Boolean  @default(false)
  updatedAt            DateTime @updatedAt

  @@id([userId, topicId])
  @@map("UserTopicProgress")
}

model TestAttempt {
  testAttemptId Int     @id @default(autoincrement())
  userId        Int
  testId        Int
  score         Int
  details       Json?

  @@map("TestAttempt")
}
